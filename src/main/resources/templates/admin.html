<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
>
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css"
          integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I" crossorigin="anonymous">

    <meta charset="UTF-8">
    <title>Admin panel</title>
    <style>
        .button-style {
            display: inline-block;
            padding: 5px 10px;
            background-color: green;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }

        .button-style1 {
            display: inline-block;
            padding: 5px 10px;
            background-color: red;
            color: white;
            text-decoration: none;
            border: none;
            border-radius: 5px;
        }

        th, td {
            padding: 5px; /* Установка отступов внутри ячеек */
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <div class="collapse navbar-collapse d-flex justify-content-between">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <span class="nav-link text-white" id="userDetails"
                          th:text="${currentUser.email} + ' with roles: ' + ${currentUser.roles}"></span>
                </li>
            </ul>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <button class="btn text-white" onclick="location.href='/logout'">Выход</button>
                </li>
            </ul>
        </div>
    </div>
</nav>


<br>
<script>
    document.addEventListener("DOMContentLoaded", function (event) {
        var userDetails = document.getElementById("userDetails");
        userDetails.textContent = userDetails.textContent.replace('[', '').replace(']', '');
    });
</script>

<div class="row">

    <div class="col-3" style="text-align: left; height: 100vh; padding: 0;">
        <style>
            .btn-outline-primary {
                color: #007bff;
                background-color: transparent;
                border: none;
            }

            .btn-outline-primary:focus, .btn-outline-primary:active {
                color: #007bff;
                background-color: transparent;
                box-shadow: none;
            }
        </style>
        <button
                id="adminBtn" onclick="showAllUsers()" type="button" class="btn btn-outline-primary btn-lg btn-block"
                style="border-bottom-width: 0px;">Admin
        </button>

        <button
                id="userBtn" onclick="showOnlyUsers()" type="button" class="btn btn-outline-primary btn-lg btn-block"
                data-bs-toggle="button" style="border-top-width: 0px;">User
        </button>

    </div>

    <div class="col-9" style="background-color: #f2f2f2;">
        <h2>Admin panel</h2>


        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="/admin">Users table</a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="#" id="createUserLink">New User</a>

                <div id="createUserForm" style="display: none;">
                    <h4>Add new user</h4>

                    <form id="userForm" th:action="@{/create}" th:object="${users}" method="post" autocomplete="on">
                        <div class="mb-3">
                            <label for="name" class="form-label">Name</label>
                            <input type="text" class="form-control" id="name" name="name" autocomplete="on" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" autocomplete="on" required>
                        </div>
                        <div class="mb-3">
                            <label for="age" class="form-label">Age</label>
                            <input type="text" class="form-control" id="age" name="age" autocomplete="on" required>
                        </div>
                        <div class="mb-3">
                            <label for="username" class="form-label">UserName</label>
                            <input type="text" class="form-control" id="username" name="username" autocomplete="on" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="password" name="password" autocomplete="on" required>
                        </div>
                        <div class="mb-3">
                            <input type="checkbox" id="userRole" name="selectedRoles" value="ROLE_USER"> User Role
                            <input type="checkbox" id="adminRole" name="selectedRoles" value="ROLE_ADMIN"> Admin Role
                        </div>
                        <button type="submit" class="btn btn-primary">Add new user</button>
                    </form>


                </div>
            </li>
        </ul>


        <div id="usersList">
            <table class="table table-bordered" style="border-top-left-radius: 10px; border-top-right-radius: 10px;">
                <tbody>
                <tr>
                    <td>All users</td>
                </tr>
                <tr style="background-color: white;">
                    <td>
                        <table class="table">
                            <thead>
                            <tr>
                                <td colspan="8" style="background-color: #ffffff;"></td>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <th scope="col">Name</th>
                                <th scope="col">Email</th>
                                <th scope="col">Age</th>
                                <th scope="col">Username</th>
                                <th scope="col">Password</th>
                                <th scope="col">Role</th>
                                <th scope="col">Edit</th>
                                <th scope="col">Delete</th>
                            </tr>
                            <tr style="background-color: lightgray;">

                            <tr th:each="user : ${users}" class="user-row">

                                <td th:text="${user.getName()}">value</td>
                                <td th:text="${user.getEmail()}">value</td>
                                <td th:text="${user.getAge()}">value</td>
                                <td th:text="${user.getUsername()}">value</td>
                                <td th:text="${user.getPassword()}">value</td>
                                <td th:each="role:${user.getRoles()}">
                                    <span th:text="${role.getName()}"></span>
                                    <br th:if="${!roleStat.last}"/>
                                </td>
                                <td><a th:href="@{/edit(id=${user.id})}" class="button-style">Edit</a></td>
                                <td><a th:href="@{/delete(id=${user.id})}" class="button-style1">Delete</a></td>
                            </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>


        </tbody>
        </table>
    </div>

</div>

<script>
    function showAllUsers() {
        var userRows = document.querySelectorAll('.user-row');
        userRows.forEach(function (row) {
            row.style.display = 'table-row'; // показываем все строки
        });
    }

    function showOnlyUsers() {
        var userRows = document.querySelectorAll('.user-row');
        userRows.forEach(function (row) {
            var roleCell = row.querySelector('span');
            if (roleCell && roleCell.textContent.trim() !== 'ROLE_USER') {
                row.style.display = 'none'; // скрываем строки с ролью отличной от 'ROLE_USER'
            } else {
                row.style.display = 'table-row'; // показываем строки с ролью 'ROLE_USER'
            }
        });
    }

    document.addEventListener("DOMContentLoaded", function (event) {
        document.getElementById('adminBtn').addEventListener('click', showAllUsers);
        document.getElementById('userBtn').addEventListener('click', showOnlyUsers);
    });


    // Обработчик события для показа формы создания нового пользователя
    document.getElementById('createUserLink').addEventListener('click', function (event) {
        event.preventDefault(); // отменить стандартное действие перехода по ссылке
        // Скрыть таблицу пользователей
        document.getElementById('usersList').style.display = 'none';
        // Показать форму создания нового пользователя
        document.getElementById('createUserForm').style.display = 'block';
    });

</script>

</body>
</html>