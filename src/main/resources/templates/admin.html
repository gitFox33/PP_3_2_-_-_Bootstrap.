<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
>
<head>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css"
          integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I" crossorigin="anonymous">

    <meta charset="UTF-8">
    <title>Admin panel</title>
    <style>

        /* Стили для кнопки открытия модального окна */
        .open-modal-btn {
            cursor: pointer;
            text-decoration: underline;
        }
        /* Стили для модального окна */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        .active-button.btn-outline-primary {
            color: #fff;
            background-color: #007bff;
            border-color: #007bff;
        }


        tbody, td, tfoot, th, thead, tr {
            border-style: none;
        }


        .button-style {
            display: inline-block;
            padding: 5px 10px;
            background-color: green;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }

        .button-style1 {
            display: inline-block;
            padding: 5px 10px;
            background-color: red;
            color: white;
            text-decoration: none;
            border: none;
            border-radius: 5px;
        }

        th, td {
            padding: 5px;
        }

        .active-tab {
            background-color: #007bff;
            color: #fff;
        }


    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <div class="collapse navbar-collapse d-flex justify-content-between">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <span class="nav-link text-white" id="userDetails"
                          th:text="${currentUser.email} + ' with roles: ' + ${currentUser.roles}"></span>
                </li>
            </ul>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <button class="btn text-white" onclick="location.href='/logout'">Выход</button>
                </li>
            </ul>
        </div>
    </div>
</nav>


<br>
<script>
    document.addEventListener("DOMContentLoaded", function (event) {
        var userDetails = document.getElementById("userDetails");
        userDetails.textContent = userDetails.textContent.replace('[', '').replace(']', '');
    });
</script>

<div class="row">

    <div class="col-3" style="text-align: left; height: 100vh; padding: 0;">
        <style>

            .btn {
                border: none;
            }


            .btn-text {
                display: flex;
                justify-content: flex-start;
            }

        </style>


        <button id="adminBtn" onclick="showAllUsers()" type="button" class="btn btn-outline-primary btn-lg btn-block"
                style="border-bottom-width: 0px;"><span class="btn-text">Admin</span>
        </button>

        <button id="userBtn" onclick="showOnlyUsers()" type="button" class="btn btn-outline-primary btn-lg btn-block"
                data-bs-toggle="button" style="border-top-width: 0px;"><span class="btn-text">User</span>
        </button>


    </div>

    <div class="col-9" style="background-color: #f2f2f2;">
        <h2>Admin panel</h2>




        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="/admin" id="usersLink">Users table</a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="#" id="createUserLink">New User</a>
            </li>
        </ul>

        <div id="createUserForm" style="display: none;">
            <h5>Add new user</h5>

            <form id="userForm" th:action="@{/create}" th:object="${users}" method="post" autocomplete="on"
                  style="background-color: white;">
                <div class="mb-4 row">
                    <div class="col-sm-3"></div>
                    <div class="col-sm-6">
                        <div class="text-center">
                            <label for="name" style="display: block;">Name</label>
                            <input type="text" class="form-control" id="name" name="name" autocomplete="on" required>
                        </div>
                    </div>
                </div>

                <div class="mb-4 row">
                    <div class="col-sm-3"></div>
                    <div class="col-sm-6">
                        <div class="text-center">
                            <label for="email" style="display: block;">Email</label>
                            <input type="email" class="form-control" id="email" name="email" autocomplete="on" required>

                        </div>
                    </div>
                </div>

                <div class="mb-4 row">
                    <div class="col-sm-3"></div>
                    <div class="col-sm-6">
                        <div class="text-center">
                            <label for="age" style="display: block">Age</label>
                            <input type="text" class="form-control" id="age" name="age" autocomplete="on" required>
                        </div>
                    </div>
                </div>


                <div class="mb-4 row">
                    <div class="col-sm-3"></div>
                    <div class="col-sm-6">
                        <div class="text-center">
                            <label for="username" style="display: block">username</label>
                            <input type="text" class="form-control" id="username" name="username" autocomplete="off"
                                   required>
                        </div>
                    </div>
                </div>


                <div class="mb-4 row">
                    <div class="col-sm-3"></div>
                    <div class="col-sm-6">
                        <div class="text-center">
                            <label for="password" style="display: block">Password</label>
                            <input type="password" class="form-control" id="password" name="password" autocomplete="off"
                                   required>
                        </div>
                    </div>
                </div>


                <div class="mb-4 row">
                    <div class="col-sm-3"></div>
                    <div class="col-sm-6">
                        <div class="form-floating mb-3">
                            <div class="text-center"><label for="userRole">Role</label></div>
                            <select class="form-select" id="userRole" name="selectedRoles"
                                    aria-label="Floating label select example">

                                <option value="ROLE_USER">USER</option>
                                <option value="ROLE_ADMIN">ADMIN</option>
                            </select>

                        </div>
                    </div>
                </div>
                <div class="mb-4 row">
                    <div class="col-sm-2"></div>
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary">Add new user</button>
                    </div>
                </div>
            </form>


        </div>


        <div id="usersList">

            <table class="table table-bordered" style="border-top-left-radius: 10px; border-top-right-radius: 10px;">
                <tbody>
                <tr>
                    <td><h5>All users</h5></td>
                </tr>
                <tr style="background-color: white;">
                    <td>

                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th scope="col">Name</th>
                                <th scope="col">Email</th>
                                <th scope="col">Age</th>
                                <th scope="col">Username</th>
                                <th scope="col">Password</th>
                                <th scope="col">Role</th>
                                <th scope="col">Edit</th>
                                <th scope="col">Delete</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="user : ${users}" class="user-row">
                                <td th:text="${user.getName()}">value</td>
                                <td th:text="${user.getEmail()}">value</td>
                                <td th:text="${user.getAge()}">value</td>
                                <td th:text="${user.getUsername()}">value</td>
                                <td th:text="${user.getPassword()}">value</td>
                                <td th:each="role:${user.getRoles()}">
                                    <span th:text="${role.getName()}"></span>
                                    <br th:if="${!roleStat.last}"/>
                                </td>



                                <td>

                                    <button class="open-modal-btn" onclick="openModal()">Открыть модальное окно</button>


                                </td>


<!--                                <td> -->
<!--                                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editUserModal">-->
<!--                                    Edit-->
<!--                                </button>-->
<!--                                </td>-->




<!--                                <td><a th:href="@{/edit(id=${user.id})}" class="button-style">Edit</a></td>-->
                                <td><a th:href="@{/delete(id=${user.id})}" class="button-style1">Delete</a></td>
                            </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        </tbody>
        </table>
    </div>
</div>

<!-- Модальное окно -->
<div id="myModal" class="modal" onclick="closeModal(event)">
    <div class="modal-content">
        <span style="float: right; cursor: pointer;" onclick="closeModal(event)">&times;</span>
        <h2>Форма изменения пользователя</h2>


        <form id="22" th:action="@{/create}" th:object="${user}" method="post" autocomplete="on"
              style="background-color: white;">
            <div class="mb-4 row">
                <div class="col-sm-3"></div>
                <div class="col-sm-6">
                    <div class="text-center">
                        <label for="name" style="display: block;">Name</label>
                        <input type="text" class="form-control" id="name" name="name" autocomplete="on" required>
                    </div>
                </div>
            </div>

            <div class="mb-4 row">
                <div class="col-sm-3"></div>
                <div class="col-sm-6">
                    <div class="text-center">
                        <label for="email" style="display: block;">Email</label>
                        <input type="email" class="form-control" id="email" name="email" autocomplete="on" required>

                    </div>
                </div>
            </div>

            <div class="mb-4 row">
                <div class="col-sm-3"></div>
                <div class="col-sm-6">
                    <div class="text-center">
                        <label for="age" style="display: block">Age</label>
                        <input type="text" class="form-control" id="age" name="age" autocomplete="on" required>
                    </div>
                </div>
            </div>


            <div class="mb-4 row">
                <div class="col-sm-3"></div>
                <div class="col-sm-6">
                    <div class="text-center">
                        <label for="username" style="display: block">username</label>
                        <input type="text" class="form-control" id="username" name="username" autocomplete="off"
                               required>
                    </div>
                </div>
            </div>


            <div class="mb-4 row">
                <div class="col-sm-3"></div>
                <div class="col-sm-6">
                    <div class="text-center">
                        <label for="password" style="display: block">Password</label>
                        <input type="password" class="form-control" id="password" name="password" autocomplete="off"
                               required>
                    </div>
                </div>
            </div>


            <div class="mb-4 row">
                <div class="col-sm-3"></div>
                <div class="col-sm-6">
                    <div class="form-floating mb-3">
                        <div class="text-center"><label for="userRole">Role</label></div>
                        <select class="form-select" id="userRole" name="selectedRoles"
                                aria-label="Floating label select example">

                            <option value="ROLE_USER">USER</option>
                            <option value="ROLE_ADMIN">ADMIN</option>
                        </select>

                    </div>
                </div>
            </div>
            <div class="mb-4 row">
                <div class="col-sm-2"></div>
                <div class="text-center">
                    <button type="submit" class="btn btn-primary">Add new user</button>
                </div>
            </div>



            <!--        <form method="POST" action="/edit" id="editForm">-->
<!--            <label for="name">Name: </label>-->
<!--            <input type="text" name="name" id="name.edit" required/>-->
<!--            <br>-->
<!--            <br>-->
<!--            <label for="email">Email: </label>-->
<!--            <input type="email" name="email" id="email" required/>-->
<!--            <br>-->
<!--            <br>-->
<!--            <label for="age">Age: </label>-->
<!--            <input type="number" name="age" id="age" required/>-->
<!--            <br>-->
<!--            <br>-->
<!--            <label for="username">Username: </label>-->
<!--            <input type="text" name="username" id="username" required/>-->
<!--            <br>-->
<!--            <br>-->
<!--            <label for="password">Password: </label>-->
<!--            <input type="text" name="password" id="password" required/>-->
<!--            <br>-->
<!--            <br>-->
<!--            <label for="role1">Set user role</label>-->
<!--            <input type="checkbox" name="ROLE_USER" id="role1" />-->
<!--            <br>-->
<!--            <label for="role2">Set admin role</label>-->
<!--            <input type="checkbox" name="ROLE_ADMIN" id="role2" />-->
<!--            <br>-->
<!--            <br>-->
<!--            <input type="submit" value="Update!">-->
        </form>
    </div>
</div>


<script>

    document.getElementById('usersLink').addEventListener('click', function(event) {
        event.preventDefault();
        document.getElementById('createUserLink').classList.remove('active');
        document.getElementById('usersLink').classList.add('active');
        document.getElementById('createUserForm').style.display = 'none';
        document.getElementById('usersList').style.display = 'block';
    });

    document.getElementById('createUserLink').addEventListener('click', function(event) {
        event.preventDefault();
        document.getElementById('usersLink').classList.remove('active');
        document.getElementById('createUserLink').classList.add('active');
        document.getElementById('usersTable').style.display = 'none';
        document.getElementById('createUserForm').style.display = 'block';
    });

    function showAllUsers() {
        var userRows = document.querySelectorAll('.user-row');
        userRows.forEach(function (row) {
            row.style.display = 'table-row';
        });
        document.getElementById('adminBtn').classList.add('active-button');
        document.getElementById('userBtn').classList.remove('active-button');
    }

    function showOnlyUsers() {
        var userRows = document.querySelectorAll('.user-row');
        userRows.forEach(function (row) {
            var roleCell = row.querySelector('span');
            if (roleCell && roleCell.textContent.trim() !== 'ROLE_USER') {
                row.style.display = 'none';
            } else {
                row.style.display = 'table-row';
            }
        });
        document.getElementById('userBtn').classList.add('active-button');
        document.getElementById('adminBtn').classList.remove('active-button');
    }

    // JavaScript для открытия и закрытия модального окна
    function openModal() {
        var modal = document.getElementById('myModal');
        modal.style.display = "block";
    }

    function closeModal(event) {
        var modal = document.getElementById('myModal');
        if (event.target === modal) {
            modal.style.display = "none";
        }
    }


    // Добавляем класс active-button к кнопке "Admin" при загрузке страницы
    window.onload = function () {
        document.getElementById('adminBtn').classList.add('active-button');
    };


    // Обработчик события для показа формы создания нового пользователя
    document.getElementById('createUserLink').addEventListener('click', function (event) {
        event.preventDefault(); // отменить стандартное действие перехода по ссылке
        // Скрыть таблицу пользователей
        document.getElementById('usersList').style.display = 'none';
        // Показать форму создания нового пользователя
        document.getElementById('createUserForm').style.display = 'block';
    });

</script>




</body>
</html>